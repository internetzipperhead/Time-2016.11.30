<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Ajax</title>
    <link rel="stylesheet" href="../lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../css/index.css"/>
    <link rel="stylesheet" href="../css/oop.css"/>
</head>
<body>
    <script src="../lib/jquery-1.12.1.min.js"></script>
    <script src="../js/Interface.js"></script>
    <script>
        //先定义一个Ajax处理器的一个接口
        var AjaxHandler = new Interface("AjaxHandler",["request","createXhrObject"]);

        var simpleAjaxHandler = function(){};

        simpleAjaxHandler.prototype = {
            request: function(method,url,data,callback){
                var xhr = this.createXhrObject();   //这里就是Ajax的东西了
                xhr.onreadystatechange = function(){
                    if(xhr.readyState != 4) return;
                    if(xhr.status == 200){
                        callback.success(xhr.responseText);
                    } else {
                        callback.failure(xhr.status);
                    }
                };
                xhr.open(method,url,true);
                if(method != "post") data = null;
                xhr.send(data);
            },
            createXhrObject: function(){
                var methods = [
                        function(){return new XMLHttpRequest();},
                        function(){return new ActiveXObject("MSxml12.XMLHTTP");},
                        function(){return new ActiveXObject("Microsoft.XMLHTTP");}
                ];
                for(var i= 0;i<methods.length;i++){
                    try{
                        var f = methods[i]();
                        /**
                         * 下面一段代码的作用是用来提高运行效率的。不知道你理解与否
                         */
                        this.createXhrObject = methods[i];
                        return f;
                    } catch(e){
                        continue;
                    }
                }
                throw new Error("你的浏览器需要支持XMLHttpRequest对象");
            }
        };

        var simplehandler = new simpleAjaxHandler();
        Interface.checkImplements(simplehandler, AjaxHandler);

        var callback = {
            success: function(txt){
                alert("success:"+txt);
            },
            failure:function(code){
                alert("failure:"+ code);
            }
        };

        simplehandler.request("get","02.txt",null,callback);


    </script>
</body>
</html>