# http

## TCP

1. 三次握手
2. 四次挥手
3. 滑动窗口: 流量控制
4. 拥塞处理
  慢开始
  拥塞避免
  快速重传
  快速恢复

### TCP三次握手

> 建立连接前，客户端和服务端需要通过握手来确认对方:

1. 客户端发送 syn(同步序列编号) 请求，进入 syn_send 状态，等待确认
2. 服务端接收并确认 syn 包后发送 syn+ack 包，进入 syn_recv 状态
3. 客户端接收 syn+ack 包后，发送 ack 包，双方进入 established 状态

### TCP四次挥手

1. 客户端 -- FIN --> 服务端， FIN—WAIT
2. 服务端 -- ACK --> 客户端， CLOSE-WAIT
3. 服务端 -- ACK,FIN --> 客户端， LAST-ACK
4. 客户端 -- ACK --> 服务端，CLOSED

> 由于TCP连接是全双工的，因此每个方向都必须单独进行关闭，所以即使没有最后一个包，也需要先回复断开连接的请求，然后再发送关闭请求

## 缓存策略

> 可分为 强缓存 和 协商缓存

1. Cache-Control/Expires: 浏览器判断缓存是否过期，未过期时，直接使用强缓存，Cache-Control的 max-age 优先级高于 Expires
2. 当缓存已经过期时，使用协商缓存
  唯一标识方案: Etag(response 携带) & If-None-Match(request携带，上一次返回的 Etag): 服务器判断资源是否被修改，
  最后一次修改时间: Last-Modified(response) & If-Modified-Since (request，上一次返回的Last-Modified)
    * 如果一致，则直接返回 304 通知浏览器使用缓存
    * 如不一致，则服务端返回新的资源

Last-Modified 缺点

* 周期性修改，但内容未变时，会导致缓存失效
* 最小粒度只到 s， s 以内的改动无法检测到

Etag 的优先级高于 Last-Modified

## 应用层

应用层( application-layer ）的任务是通过应用进程间的交互来完成特定网络应用

应用层交互的数据单元称为报文

### 域名系统

域名系统( Domain Name System )是因特网的一项核心服务，它作为可以将域名和 IP 地址相互映射的一个分布式数据库，能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的 IP 数串。

### http 协议

超文本传输协议（ HyperText Transfer Protocol ）是互联网上应用最为广泛的一种网络协议。所有的 WWW（万维网） 文件都必须遵守这个标准。

## 传输层

传输层(transport layer)的主要任务就是负责向两台主机进程之间的通信提供通用的数据传输服务。应用进程利用该服务传送应用层报文

传输层常用的两种协议

1. 传输控制协议-TCP：提供面向连接的，可靠的数据传输服务。
2. 用户数据协议-UDP：提供无连接的，尽最大努力的数据传输服务（不保证数据传输的可靠性）。

* TCP 是面向连接的（需要先建立连接）
* 每一条 TCP 连接只能有两个端点，每一条 TCP 连接只能是一对一
* TCP提供可靠交付的服务。通过TCP连接传送的数据，无差错、不丢失、不重复、并且按序到达
* TCP 提供全双工通信。TCP 允许通信双方的应用进程在任何时候都能发送数据。TCP 连接的两端都设有发送缓存和接收缓存，用来临时存放双方通信的数据
* 面向字节流。TCP 中的“流”（Stream）指的是流入进程或从进程流出的字节序列

* UDP 是无连接的
* UDP 是尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态
* UDP 是面向报文的
* UDP 没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低（对实时应用很有用，如直播，实时视频会议等）
* UDP 支持一对一、一对多、多对一和多对多的交互通信
* UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短

## 网络层

网络层的任务就是选择合适的网间路由和交换结点，确保计算机通信的数据及时传送。
在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组和包进行传送。
在 TCP/IP 体系结构中，由于网络层使用 IP 协议，因此分组也叫 IP 数据报 ，简称数据报

## 数据链路层

数据链路层(data link layer)通常简称为链路层。两台主机之间的数据传输，总是在一段一段的链路上传送的，这就需要使用专门的链路层的协议
在两个相邻节点之间传送数据时，数据链路层将网络层接下来的 IP 数据报组装成帧，在两个相邻节点间的链路上传送帧。每一帧包括数据和必要的控制信息（如同步信息，地址信息，差错控制等）

## 物理层

在物理层上所传送的数据单位是比特。
物理层(physical layer)的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。使其上面的数据链路层不必考虑网络的具体传输介质是什么。
“透明传送比特流”表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。
在互联网使用的各种协议中最重要和最著名的就是 TCP/IP 两个协议。